<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0">
    <meta name="description"
          content="UFMS云货代系统，实现业务财务一体化，整合企业网站，微信和内部ERP系统。可量身定制开发。对外平台：涵盖客户网上运价查询，在线订舱、补料、对单，查询库存账单及流程跟踪。内部操作系统：包含海运、空运、拖车、报关、仓储、人事行政，内部OA，财务">
    <meta name="author" content="Neo">
    <meta name="keywords" content="UFMS,货代软件,货代系统,财务系统">
    <link rel="shortcut icon" href="favicon.ico"/>
    <link rel="icon" type="image/gif" href="favicon.ico"/>
    <title>SO.UFMS </title>

    <link rel="stylesheet" href="../res/static/css/index.css?t=13">
    <link rel="stylesheet" href="../res/static/css/login.css?t=13">

    <link rel="stylesheet" href="/so/res/layui/css/layui.css">
    <script src="/so/res/static/js/jquery.min.js"></script>

    <script src="/so/res/layui/layui.js"></script>

    <script src="../admin/js/ufms.common.js?t=12"></script>
    <script src="../res/static/js/index.js?t=13"></script>

    <script src="../res/static/js/jquery.cookie.js?t=1"></script>
    <script src="/so/admin/js/jquery.i18n.properties-min-1.0.9.js"></script>

</head>
<body>

<!-- nav部分 -->
<div class="nav" id="nav">
</div>

<!-- nav二级部分 -->
<div class="nav_level2" id="nav_level2">
</div>

<!-- main -->
<div class="layui-row" style="max-width: 1200px;">

    <form method="post" class="layui-form" id="form" lay-filter="user">
        <div class="layui-row ">
            <div class="layui-col-lg6">
                <div class="layui-form-item">
                    <label class="layui-form-label">公司名称</label>
                    <div class="layui-input-block">
                        <input name="corpnamec" placeholder="" type="text" lay-verify="required" class="layui-input" disabled="disabled">
                        <input name="id" placeholder="" type="text" lay-verify="required" class="layui-input layui-hide">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">中文名</label>
                    <div class="layui-input-block">
                        <input name="namec" placeholder="" type="text" lay-verify="required" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">英文名</label>
                    <div class="layui-input-block">
                        <input name="namee" placeholder="" type="text" lay-verify="required" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">TEL</label>
                    <div class="layui-input-block">
                        <input name="tel1" placeholder="" type="text" class="layui-input">
                    </div>
                </div>
                <!--<div class="layui-form-item" >
                    <label class="layui-form-label" >TEL2</label>
                    <div class="layui-input-block">
                      <input name="tel2" placeholder=""  type="text" l class="layui-input" >
                    </div>
                </div>
                -->
                <div class="layui-form-item">
                    <label class="layui-form-label">EMAIL</label>
                    <div class="layui-input-block">
                        <input name="email1" placeholder="" type="text" class="layui-input">
                    </div>
                </div><!--
					    <div class="layui-form-item" >
					    	<label class="layui-form-label" >EMAIL2</label>
						    <div class="layui-input-block">
						      <input name="email2" placeholder=""  type="text"  class="layui-input" >
						    </div>
					    </div>
					--></div>
            <div class="layui-col-lg6">
                <div class="layui-form-item">
                    <label class="layui-form-label">QQ</label>
                    <div class="layui-input-block">
                        <input name="qq" placeholder="" type="text" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">MSN</label>
                    <div class="layui-input-block">
                        <input name="msn" placeholder="" type="text" class="layui-input">
                    </div>
                </div><!--
					    <div class="layui-form-item" >
					    	<label class="layui-form-label" >备注</label>
						    <div class="layui-input-block">
						      <input name="remarks" placeholder=""  type="text"  class="layui-input" >
						    </div>
					    </div>
					    -->
                <div class="layui-form-item">
                    <label class="layui-form-label">订阅微信</label>
                    <div class="layui-input-block">
                        <input type="checkbox" name="issubscribeweixin" lay-skin="primary">
                    </div>
                </div>
                <!--
                <div class="layui-form-item" >
                    <label class="layui-form-label" >订阅邮件</label>
                    <div class="layui-input-block">
                      <input type="checkbox" name="issubscribeemail" lay-skin="primary">
                    </div>
                </div>
                <div class="layui-form-item" >
                    <label class="layui-form-label" >订阅短信</label>
                    <div class="layui-input-block">
                      <input type="checkbox" name="issubscribesms" lay-skin="primary">
                    </div>
                </div>
                 -->
                <input name="id" autocomplete="off" class="layui-input" style="display:none;">
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-row">
                <button type="button" class="layui-btn layui-btn-normal" lay-submit lay-filter="savecs" style="width:100px;" type="submit"><span
                        class="translate">保存</span></button>
                <button type="button" class="layui-btn layui-btn-primary" lay-submit lay-filter="resets" style="width:100px;" type="submit"><span
                        class="translate">重设</span></button>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-row">
                <button type="button" class="layui-btn layui-btn-primary" lay-submit lay-filter="bindWeChat" type="submit"><i
                        class="layui-icon layui-icon-login-wechat"></i><span class="translate">绑定微信</span></button>
                <button type="button" class="layui-btn layui-btn-primary" lay-submit lay-filter="notBindWeChat" type="submit"><i
                        class="layui-icon layui-icon-delete"></i><span class="translate">取消绑定</span></button>
            </div>
        </div>
    </form>

</div>
<!--[if lt IE 9]>
<script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
<script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- footer部分 -->
<div class="footer" id="footer">
</div>


<script type="text/javascript">

    $("#nav").load(getContextPath() + "/nav.html");
    $("#nav_level2").load(getContextPath() + "/managernav.html");
    $("#footer").load(getContextPath() + "/footer.html");
    actionGet('index', 'checkLogin', '', function (res) {
        var data = JSON.parse(res);
        if (data.success) {//如果登录了就把导航宽度拓展到100%
            $('#nav-logo').css({width: "1350px"});
        }
    })


    layui.use(['form', 'jquery', 'i18np'], function () {
        var form = layui.form
            , admin = layui.admin, i18np = layui.i18np;
        form = layui.form;
        i18np.translateOnForm(getLanguage());

        //监听提交保存
        form.on('submit(savecs)', function (data) {
            qryJson = JSON.stringify(data.field);
            actionPost('/user', 'savecs', qryJson, function (res) {
                var data = JSON.parse(res);
                if (data.success == true) {
                    layer.msg(data.message, {icon: 1});
                } else {
                    layer.msg(data.message, {icon: 7});
                }
            });
            return false;
        });
        form.on('submit(resets)', function (data) {
            getcsuser();
        });
        var args = getRequest();
        var userid = args.id;

        function getcsuser() {
            actionGet('/user', 'getcs', 'userid=' + userid, function (res) {
                var data = JSON.parse(res);
                form.val('user', data[0]);
                console.log(data[0]);
                if (data[0].openid == null || data[0].openid == '') {
                } else {
                    $('button[lay-filter="bindWeChat"]').addClass('layui-btn-disabled');
                    $('button[lay-filter="bindWeChat"]').attr("disabled", "disabled");
                }
            });
        }

        $(function () {
            getcsuser();
        });

        form.on('submit(bindWeChat)', function (data) {
            if (isWeiXin() == false) {
                layer.msg("请用微信客户端绑定微信", {icon: 7});
                //return;
            }
            qryJson = JSON.stringify(data.field);
            actionPost('/user', 'bindWeChat', qryJson, function (res) {
                var data = JSON.parse(res);
                if (data.success == true) {
                    //layer.msg(data.message+data.codeurl,{icon: 1});
                    parent.location.href = data.codeurl;
                    console.log(data.codeurl);
                } else {
                    layer.msg(data.message, {icon: 7});
                }
            });
        })

        form.on('submit(notBindWeChat)', function (data) {
            console.log(data.field);
            qryJson = JSON.stringify(data.field);
            actionPost('/user', 'notBindWeChat', qryJson, function (res) {
                var data = JSON.parse(res);
                if (data.success == true) {
                    layer.msg(data.message, {icon: 1});
                    $('button[lay-filter="bindWeChat"]').removeClass('layui-btn-disabled');
                    $('button[lay-filter="bindWeChat"]').removeAttr("disabled", "disabled");
                } else {
                    layer.msg(data.message, {icon: 7});
                }
            });
        })

    });
</script>
<!-- 底部结束 -->
</body>
</html>