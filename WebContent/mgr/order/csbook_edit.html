<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0">
	<meta name="description" content="UFMS云货代系统，实现业务财务一体化，整合企业网站，微信和内部ERP系统。可量身定制开发。对外平台：涵盖客户网上运价查询，在线订舱、补料、对单，查询库存账单及流程跟踪。内部操作系统：包含海运、空运、拖车、报关、仓储、人事行政，内部OA，财务">
	<meta name="author" content="Neo">
	<meta name="keywords" content="UFMS,货代软件,货代系统,财务系统">
	
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
	<meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="Expires" content="0" />
	
	
	<link rel="shortcut icon" href="favicon.ico" />
	<link rel="icon" type="image/gif" href="favicon.ico" />
	<title>SO.UFMS </title>
	
	<link rel="stylesheet" href="/so/res/layui/css/layui.css">
	<script src="/so/res/layui/layui.js"></script>
	
	<link rel="stylesheet" href="../../res/static/css/index.css?t=26">
	<link rel="stylesheet" href="../../res/layui/layui-formSelects/formSelects-v4.css">
	
	<script src="/so/res/static/js/jquery.min.js"></script>
	<script src="/so/res/static/js/jquery.cookie.js?t=1"></script>
	<script src="../../admin/js/ufms.common.js?t=13" ></script>
	<link rel="stylesheet" href="/so/res/static/css/bootstrap.min.css">
	<script src="/so/admin/js/jquery.i18n.properties-min-1.0.9.js"></script>
	<style type="text/css">
		/*设置下拉框的高度和表格单元相同*/
			.layui-table-box td .layui-form-select{
				margin-top : -5px;
				margin-left : -15px;
				margin-right : -15px;
			}
		/**结束*/
		.title-hight{
			font-size: 13px;
    		font-weight: bold;
		}
		h5{
			font: 12px/1.5 Tahoma,Helvetica,Arial,sans-serif;
		}
		body{
			font: 12px/1.5 Tahoma,Helvetica,Arial,sans-serif;
		}
		.layui-form-radio *{
		    font-size: 13px;
		    font: 12px/1.5 Tahoma,Helvetica,Arial,sans-serif;
		}
		
		.layui-form-radio {
		    padding-right: 0;
		}
		.cntdetail {
			padding: 0;
		    margin: 0;
		    margin-top: -7px;
		}
		.cntdetailinput {
			color: #555;
		    background-color: #fff;
		    background-image: none;
		    border: 1px solid #ccc;
		    border-radius: 4px;
		    box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
		    text-align: right;
		    height: 22px;
		}
	</style>
</head>
<body>
  <!-- nav部分 
  <div class="nav" id="nav">
  </div>-->
  <!-- main -->
  <div class="layui-container">
		<div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
		  <h4>单号：<span id="booknos"></span></h4>
		  <ul class="layui-tab-title">
		  	<li class="layui-this" style="padding: 0 0px">订舱</li>
		    <li style="padding: 0 0px">费用</li>
		    <li style="padding: 0 0px">明细</li>
		  </ul>
		  <div class="layui-tab-content" style="height: 100px;">
		  	<div class="layui-tab-item layui-show" style="background-color: #f6f6f6;padding: 0;margin-top: 10px;">
		    	<form class="layui-form" lay-filter="bookformfilter">
		    		<div class="layui-btn-group">
					  <button type="button" lay-filter="savebook" lay-submit
					  		class="layui-btn layui-btn-sm layui-btn-radius layui-btn-normal"><i class="layui-icon layui-icon-file"></i>保存</button>
					  <button type="button" lay-filter="savebookisubmit" lay-submit
					  		class="layui-btn layui-btn-sm layui-btn-radius layui-btn-normal"><i class="layui-icon layui-icon-release"></i>提交</button>
					</div>
					<div class="layui-form-item layui-hide">
						<input type="text" name="id" id="id" autocomplete="off" class="layui-input">
					</div>
			    	<div class="layui-row padding-bottom-10" style="border-style: ridge;border-width:1px;padding: 5px;">
						<div class="layui-col-lg6">
							<div class="layui-col-lg12">
								<ul>
									<li><h5 style="color:red" class="title-hight">Shipper(full name & address)/发货人</h5>
									<textarea id="shipper" layui-filter="shipper" name="cnorname" class="layui-textarea" onchange="this.value = this.value.toUpperCase();" style="height: 100px;" required lay-verify="required"></textarea></h5> </li>
									<li><h5 class="title-hight">Consignee/收货人 <input type="checkbox" lay-skin="primary" lay-filter="checkbox_consignee"/> TO ORDER</br>
									<textarea id="consignee" layui-filter="consignee" name="cneename" class="layui-textarea" onchange="this.value = this.value.toUpperCase();" style="height: 100px;"></textarea></h5> </li>
									<li><h5 class="title-hight">Notify/通知方 <input type="checkbox" lay-skin="primary" lay-filter="checkbox_notify" /> SAME AS CONSIGNEE</br>
									<textarea id="notify" layui-filter="notify" name="notifyname" class="layui-textarea" onchange="this.value = this.value.toUpperCase();" style="height: 100px;"></textarea></h5> </li>
								</ul>
							</div>
							<div class="layui-col-lg12">
								<ul class="layui-row">
									<li class="layui-col-lg6"><h5>Vessel/Voyage/船名航次</h5>
									<input name="vesselvoyage" type="text" class="form-control" ></input></label> </li>
									<li class="layui-col-lg6"><h5>Pre-carreage by/前程运输</h5>
									<input name="pretrans" type="text" class="form-control"></input></label> </li>
								</ul>
								<ul class="layui-row">
									<li class="layui-col-lg6"><h5> 货好时间:</h5>
										<div class="input-append" data-date-format="yyyy-mm-dd">
										    <input class="layui-input " name="goodsreadydate" type="text"  autocomplete="off" id="date_goodsreadydate"
										    	>
										   	<span class="add-on"><i class="icon-th"></i></span>
										</div>
									</label> </li>
									<li class="layui-col-lg6"><h5 style="color:red"> 船公司:</br></h5>
										<select id="shipSelect" name="shipping" class="form-control" type="text" required lay-verify="required" bind="comboboxs" bind-qry="carrier">
										</select>
									</label> </li>
									<li class="layui-col-lg6"><h5 style="color:red">航线代码</h5>
										<div id="linecodexm"></div>
									</label> </li>
									<li class="layui-col-lg6"><h5 style="color:red">航线</h5>
										<div id="routecodexm"></div>
									</label> </li>
								</ul>
								
								
								<ul class="layui-row">
									<li class="layui-col-lg4" style="padding: 5px;"><h5>Place ofreceipt/收货地</h5>
										<input name="poa" type="text" class="form-control"></input></label> 
									</li>
									<li class="layui-col-lg4" style="padding: 5px;"><h5> 驳船截关日期:</h5>
										<div class="input-append " id="datetimepicker" data-date-format="yyyy-mm-dd">
										    <input class="layui-input " name="bargecls" size="16" type="text"  autocomplete="off" id="date_bargecls" >
										   	<span class="add-on"><i class="icon-th"></i></span>
										</div>
									</label> </li>
									<li class="layui-col-lg4" style="padding: 5px;"><h5> 驳船预计离开日期:</h5>
										<div class="input-append " id="datetimepicker" data-date-format="yyyy-mm-dd">
										    <input class="layui-input " name="bargeetd" size="16" type="text"  autocomplete="off" id="date_bargeetd" >
										   	<span class="add-on"><i class="icon-th"></i></span>
										</div>
									</label> </li>
									
								</ul>
								<ul class="layui-row">
									<li class="layui-col-lg6"><h5 style="color:red">Port of loading/起运港</h5>
										<div id="polxm"></div>
										<!-- 
										<select id="polSelect" name="pol" class="form-control" type="text" required lay-verify="required" bind="comboboxs" bind-qry="pol">
										</select> -->
									</label> </li>
									<li class="layui-col-lg6"><h5>Port of discharge/卸货港</h5>
										<div id="pddxm"></div>
										<!-- 
										<select id="pddSelect" name="pdd" class="form-control" type="text" bind="comboboxs" bind-qry="pod">
										</select> -->
									</label> </li>
									<li class="layui-col-lg6"><h5 style="color:red">Port of delivery/目的港</h5>
										<div id="podxm"></div>
										<!-- 
										<select id="podSelect" name="pod" class="form-control" type="text" required lay-verify="required" bind="comboboxs" bind-qry="pod">
										</select> -->
									</label> </li>
									<li class="layui-col-lg6"><h5>Port of delivery/目的地</h5>
										<div id="destinationxm"></div>
										<!-- 
										<select id="destinationSelect" name="destination" class="form-control" type="text" bind="comboboxs" bind-qry="pod">
										</select> -->
									</label> </li>
									<li class="layui-col-lg4" style="padding: 5px;"><h5 style="color:red"> 截关日期:</h5>
										<div class="input-append " id="datetimepicker" data-date-format="yyyy-mm-dd">
										    <input class="layui-input" id="date_cls" name="cls" size="16" type="text" required lay-verify="required">
										   	<span class="add-on"><i class="icon-th"></i></span>
										</div>  
									</label> </li>
									<li class="layui-col-lg4" style="padding: 5px;"><h5>ETD:</h5>
										<div class="input-append" id="datetimepicker" data-date-format="yyyy-mm-dd">
										    <input class="layui-input" id="date_etd" name="etd" size="16" data-date-format="yyyy-mm-dd" type="text" >
										   	<span class="add-on"><i class="icon-th"></i></span>
										</div>
									</label> </li>
									<li class="layui-col-lg4" style="padding: 5px;"><h5> 开船日期:</h5>
										<div class="input-append " id="datetimepicker" data-date-format="yyyy-mm-dd">
										    <input class="layui-input " name="atd" size="16" type="text"  autocomplete="off" id="date_atd" >
										   	<span class="add-on"><i class="icon-th"></i></span>
										</div>
									</label> </li>
								</ul>
							</div>
							
						</div>
						<div class="layui-col-lg6">
							<div class="layui-col-lg12">
								<ul class="layui-row">
									<li class="layui-col-lg4"><h5> 运输条款</h5></li>
									<li class="layui-col-lg8">
										<select name="carryitem" class="form-control" lay-search="">
										  <option value="CFS-CFS">CFS-CFS</option>
										  <option value="CFS-CY">CFS-CY</option>
										  <option value="CFS-DOOR">CFS-DOOR</option>
										  <option value="CY-CFS">CY-CFS</option>
										  <option value="CY-CY">CY-CY</option>
										  <option value="CY-DOOR">CY-DOOR</option>
										  <option value="CY-FO">CY-FO</option>
										  <option value="DOOR-CY">DOOR-CY</option>
										  <option value="DOOR-DOOR">DOOR-DOOR</option>
										  <option value="FCL-FCL">FCL-FCL</option>
										</select>
									</li>
									<li class="layui-col-lg4" style="padding-top:5px;color:red"><h5> 运费条款</label></li>
									<li class="layui-col-lg8" style="padding-top:5px;">
										<select name="freightitem" class="form-control" lay-verify="required" lay-search="">
										  <option value="PP">FREIGHT PREPAID</option>
										  <option value="CC">FREIGHT COLLECT</option>
										  <option value="PD">FREIGHT PAYABLE AT DESTINATION</option>
										  <option value="HK">FREIGHT PAYABLE AT HONGKONG</option>
										</select>
									</li>
								</ul>
								<ul class="layui-row">
									<li class="layui-col-lg4"><h5> 提单方式 </<h5></li>
									<li class="layui-col-lg8">
										<input type="radio" name="bltype" value="M" title="MB/L"/> 
										<input type="radio" name="bltype" value="H" checked="checked" title="HB/L"/> 
									</li>
								</ul>
								<ul class="layui-row">
									<li class="layui-col-lg4"><h5> 放货方式:</h5>
									</li>
									<li class="layui-col-lg8">
										<select class="form-control" name="putertype" id="putertype">
											 	<option value="O"> 正本</option>
												<option value="T"> 电放</option>
										</select>
									</li>
								</ul>
								<ul class="layui-row">
									<li class="layui-col-lg4"><h5> 付款方式 </h5></li>
									<li class="layui-col-lg8">
										<input type="radio" name="ppcc" checked="checked" value="PP" title="预付/PP" />
										<input type="radio" name="ppcc" value="CC" title="到付/CC"/>
									</li>
								</ul>
								<ul class="layui-row">
									<li class="layui-col-lg4"><h5 style="color:red">付款地点</h5></li>
									<li class="layui-col-lg8"><input name="payplace" type="text" class="form-control" required lay-verify="required"></input></label> </li>
								</ul>
								<!--
								<ul class="layui-row">
									<li class="layui-col-lg4"><input type="checkbox" name="isinvoice" lay-skin="primary"  title="开具发票"/></li>
								</ul>  -->
								
							</div>
							<div class="layui-col-lg12">
				        		<ul class="layui-row">
									<li class="layui-col-lg6"><h5> 件数</h5>
									<input class="form-control" name="piece" type="text" required onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}" onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"></input></label> </li>
									<li class="layui-col-lg6"><h5> 包装</h5>
										<select id="packgeSelect" name="packer" class="form-control">
										</select>
									</label>
									</li>
									<li class="layui-col-lg6"><h5 style="color:red"> 毛重/KGS</h5>
									<input class="form-control" name="grswgt" type="text" readonly></input></label> </li>
									<li class="layui-col-lg6"><h5> 合约号</h5>
									<input class="form-control" name="contractno" type="text"></input></label> </li>
									<li class="layui-col-lg6"><h5> 体积/CBM</h5>
									<input class="form-control" name="cbm" type="text" required onkeyup="onlyNumber(this,3)"></input></label> </li>
									<li class="layui-col-lg6"><h5> 参考号</h5>
									<input class="form-control" name="refno" type="text"></input></label> </li>
								</ul>
							</div>
							<div class="layui-col-lg12">
				        		<ul class="layui-row">
									<li class="layui-col-lg6"><h5>唛头<span style="color: red">(限英文，数字，每行35字符，回车为一行)</span></h5>
									<textarea class="layui-textarea" name="marksno" style="height:155px;"></textarea></label> </li>
									<li class="layui-col-lg6"><h5>品名<span style="color: red">(限英文，数字，每行35字符，回车为一行)</span></h5>
									<textarea class="layui-textarea" name="goodsdesc" style="height:155px;"></textarea></label> </li>
								</ul>
							</div>
						</div>
			        </div>
			        <ul class="layui-row" style="border-style: ridge;border-width:1px;padding: 5px;font: 12px/1.5 Tahoma,Helvetica,Arial,sans-serif;">
			        	<li class="layui-col-lg12"><h5 style="font-weight:bold"> 我司还可以提供以下服务：</h5></li>
						<li class="layui-col-lg4"><input type="checkbox" name="istrailer" lay-skin="primary"  title="委托我司安排拖车"/></li>
						<li class="layui-col-lg4"><input type="checkbox" name="isdeclare" lay-skin="primary" title="委托我司报关"/></li>
						<li class="layui-col-lg4"><input type="checkbox" name="isbusinvoice" lay-skin="primary" title="委托我司开发票"/></li>
						<li class="layui-col-lg4"><input type="checkbox" name="iswarehouse" lay-skin="primary" title="委托我司入仓库"/></li>
						<li class="layui-col-lg4"><input type="checkbox" name="isdeclarevmg" lay-skin="primary" title="委托我司申报VGM"/></li>
						<li class="layui-col-lg4"><input type="checkbox" name="isfumigation" lay-skin="primary" title="委托我司熏蒸"/></li>
						<li class="layui-col-lg4"><input type="checkbox" name="isinsurance" lay-skin="primary" title="委托我司代买保险"/></li>
						<li class="layui-col-lg4"><input type="checkbox" name="iscertificate" lay-skin="primary" title="委托我司代地产证"/></li>
					</ul>
			        <div class="layui-row" style="border-style: ridge;border-width:1px;padding: 5px;">
		        		<div class="layui-col-lg12" style="border-bottom-style: ridge;border-width:1px">
		        			<div class="layui-col-lg12">
				        		<ul class="layui-row" >
									<li class="layui-col-lg12"><h5 style="color:red;font-weight:bold"> 委托订舱联系人:</h5></li>
									<li class="layui-col-lg4" style="padding: 5px;"><h5 style="color:red"> 联系人:</br>
									<input class="form-control" name="blcontacts" required required lay-verify="required"></input></label> </li>
									<li class="layui-col-lg4" style="padding: 5px;"><h5 style="color:red"> 电话:</br>
									<input class="form-control" name="phone" required lay-verify="required" onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}" onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"></input></label> </li>
									<li class="layui-col-lg4" style="padding: 5px;"><h5 style="color:red">E-MAIL:</br>
									<input class="form-control" name="email" type="email" required lay-verify="required"></input> </li>
								</ul>
							</div>
						</div>
						<div class="layui-col-lg12" style="border-bottom-style: ridge;border-width:1px;padding: 5px;">
							<div class="layui-col-lg12">
								<ul class="layui-row">
									<li class="layui-col-lg12"><span style="font-weight:bold"> 提单联系人: </span><input type="checkbox" lay-skin="primary" lay-filter="setbillname" title="与委托联系人一致"/></li>
									<li class="layui-col-lg4" style="padding: 5px;"><h5> 联系人: </br>
									<input class="form-control" name="billname" required></input></label> </li>
									<li class="layui-col-lg4" style="padding: 5px;"><h5> 电话:</br>
									<input class="form-control" name="billtel" required onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}" onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"></input></label> </li>
									<li class="layui-col-lg4" style="padding: 5px;"><h5>E-MAIL:</br>
									<input class="form-control" name="billemail" type="email"/></h5> </li>
								</ul>
							</div>
						</div>
						<div class="layui-col-lg12" style="border-bottom-style: ridge;border-width:1px;padding: 5px;">
							<div class="layui-col-lg12">
								<ul class="layui-row">
									<li class="layui-col-lg12"><span style="font-weight:bold"> 财务联系人: </span><input type="checkbox" lay-skin="primary" lay-filter="setfinaceneme" title="与委托联系人一致"/></li>
									<li class="layui-col-lg4" style="padding: 5px;"><h5> 联系人: </br>
									<input class="form-control" name="financename" required></input></label> </li>
									<li class="layui-col-lg4" style="padding: 5px;"><h5> 电话:</br>
									<input class="form-control" name="financetel" required onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}" onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"></input></label> </li>
									<li class="layui-col-lg4" style="padding: 5px;"><h5>E-MAIL:</br>
									<input class="form-control" name="financeemail" type="email"/></h5> </li>
								</ul>
							</div>
						</div>
						<div class="layui-col-lg12">
			        		<div class="layui-col-lg12">
				        		<ul class="layui-row">
									<h5 class="title-hight">备注<h5></br>
									<textarea class="layui-textarea" name="remarks" style="height:80px;padding: 1px;" placeholder="订舱或其他服务要求，请在此说明"></textarea></h5> </li>
								</ul>
							</div>
						</div>
			        </div>
			    </form>
			</div>
		    <div class="layui-tab-item"><table id="actTable" lay-filter="arapFiter"></table></div>
		    <div class="layui-tab-item"><table id="cntTable" lay-filter="cntdetail"></table></div>
		</div> 
  	</div>
  </div>
  <form class="layui-form" id="arapFilter" style="display:none" lay-filter="arapFilter">
  		<div class="layui-form-item">
			<div class="layui-form-item">
				<input type="text" name="id" id="id" autocomplete="off" class="layui-input layui-hide">
				<button type="button" class="layui-btn layui-btn-normal" lay-submit lay-filter="savebookingfee" type="submit">保存</button>
			</div>
			<div class="layui-inline">
				<label class="layui-form-label">收付</label>
				<div class="layui-input-inline">
					<select name="araptype">
			        	<option value="AR">应收</option>
			        	<option value="AP">应付</option>
			        </select>
				</div>
			</div>
			<div class="layui-inline">
				<label class="layui-form-label">柜型</label>
				<div class="layui-input-inline">
					<select name="cntype">
						
			        </select>
				</div>
			</div>
			<div class="layui-inline">
				<label class="layui-form-label">PP/CC</label>
				<div class="layui-input-inline">
					<select name="ppcc">
			        	<option value="PP">PP</option>
			        	<option value="CC">CC</option>
			        </select>
				</div>
			</div>
		    <div class="layui-inline">
		    	<label class="layui-form-label">费用名称</label>
				<div class="layui-input-inline" style="width:260px;">
					<div id="feeitemidxm"></div>
					<!--<select id="feeitemid" name="feeitemid" lay-search="" xm-select="checkbox_feei" xm-select-search="" xm-select-radio="" xm-select-skin="normal">
				        <option value="">选择费用</option>
				   </select>-->
				</div>
			</div>
			<div class="layui-inline">
		      <label class="layui-form-label">币值</label>
		      <div class="layui-input-inline">
		      	<select name="currency" lay-verify="required" bind="comboboxs">
					     <option value="">请选择</option>
				</select>
		      </div>
		    </div>
			<div class="layui-inline">
		      <label class="layui-form-label">单位</label>
		      <div class="layui-input-inline">
		      	<input type="text" name="unit" id="unit" autocomplete="off" class="layui-input">
		      </div>
		    </div>
		    <div class="layui-inline">
		      <label class="layui-form-label">数量</label>
		      <div class="layui-input-inline">
		      	<input type="text" name=cntcount id="price" autocomplete="off" class="layui-input">
		      </div>
		    </div>
		    <div class="layui-inline">
		      <label class="layui-form-label">金额</label>
		      <div class="layui-input-inline">
		      	<input type="text" name="amount" id="amount" autocomplete="off" class="layui-input">
		      </div>
		    </div>
		</div>
  </form>
  <!-- footer部分
  <div class="footer" id="footer"> 
  </div>-->
<!--[if lt IE 9]>
  <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
  <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<script type="text/html" id="toolbar">
  <div class="layui-btn-container">
	<button class="layui-btn layui-btn-sm  layui-btn-normal" type="button" lay-event="querycnt"><i class="layui-icon layui-icon-refresh-3"></i>刷新</button>
	<button class="layui-btn layui-btn-sm  layui-btn-normal" type="button" lay-event="savecnt"><i class="layui-icon layui-icon-file"></i>保存</button>
	<button class="layui-btn layui-btn-sm  layui-btn-normal" type="button" lay-event="addcnt"><i class="layui-icon layui-icon-add-circle"></i>新增</button>
	<button class="layui-btn layui-btn-sm  layui-btn-normal" type="button" lay-event="deletecnt"><i class="layui-icon layui-icon-delete"></i>删除</button>
  </div>
</script>
<script type="text/html" id="arapBar">
  <button class="layui-btn layui-btn-xs fina_arap_update" type="button" lay-event="barEdit"><i class="layui-icon layui-icon-edit"></i>编辑</button>
  <button class="layui-btn layui-btn-xs fina_arap_delete" type="button" lay-event="bardelete"><i class="layui-icon layui-icon-delete"></i>删除</button>
</script>
<script type="text/html" id="araptoolbar">
  <div class="layui-btn-container">
	<button class="layui-btn layui-btn-sm layui-btn-normal fina_arap_add" type="button" lay-event="addarap"><i class="layui-icon layui-icon-add-circle"></i>新增</button>
  </div>
</script>

<script>
layui.use(['jquery','layer','form','table','laydate','formSelects','tablePlug','xmSelect'], function() {
	$ = layui.jquery;
	var form = layui.form,table = layui.table,laydate=layui.laydate
	,formSelects = layui.formSelects, tablePlug = layui.testTablePlug
	xmSelect = layui.xmSelect; //只有执行了这一步，部分表单元素才会自动修饰成功
	form.render();
	getCombobox(form);
	var parav = getRequest();
	var para = new Object;
    para.id = parav.id

  	//日期
  	laydate.render({
    	elem: '#date_etd'
  	});
  	laydate.render({
    	elem: '#date_atd'
  	});
  	laydate.render({
    	elem: '#date_cls'
  	});
  	laydate.render({
    	elem: '#date_bargecls'
  	});
  	laydate.render({
    	elem: '#date_bargeetd'
  	});
  	laydate.render({
    	elem: '#date_goodsreadydate'
    	,type: 'datetime'
  	});
    
	actionPost('/booking','getcsbooking',JSON.stringify(para),function(res){
		var resjson = JSON.parse(res);
    	if(resjson.success == false){
    		layer.msg(resjson.msg,{icon: 7});
		}else{
			resjson.goodsreadydate = resjson.goodsreadydate!=null?layui.util.toDateString(resjson.goodsreadydate, "yyyy-MM-dd HH:mm:ss"):null;
			getComboboxSet(form,resjson);
			form.val("bookformfilter",resjson);
			var configDataSet = new randerXmselect.getConfig();
			configDataSet.name = 'pol';configDataSet.action='fclpol';configDataSet.el='#polxm',configDataSet.initValue=[resjson.pol];
			var polxm = new randerXmselect.rander(xmSelect,configDataSet);
			var configDataSetpod = new randerXmselect.getConfig();
			configDataSetpod.name = 'pod';configDataSetpod.action='fclpod';configDataSetpod.el='#podxm',configDataSetpod.initValue=[resjson.pod];
			var podxm = new randerXmselect.rander(xmSelect,configDataSetpod);
			var configDataSetpdd = new randerXmselect.getConfig();
			configDataSetpdd.name = 'pdd';configDataSetpdd.action='fclpod';configDataSetpdd.el='#pddxm',configDataSetpdd.initValue=[resjson.pdd];
			var pddxm = new randerXmselect.rander(xmSelect,configDataSetpdd);
			var configDataSetdestin = new randerXmselect.getConfig();
			configDataSetdestin.name = 'destination';configDataSetdestin.action='fclpod';configDataSetdestin.el='#destinationxm',configDataSetdestin.initValue=[resjson.destination];
			var destinationxm = new randerXmselect.rander(xmSelect,configDataSetdestin);
			var configDataSetLine = new randerXmselect.getConfig();
			configDataSetLine.name = 'linecode';configDataSetLine.action='linecode';configDataSetLine.el='#linecodexm',configDataSetLine.initValue=[resjson.linecode];
			var polxm = new randerXmselect.rander(xmSelect,configDataSetLine);
			var configDataSetRoute = new randerXmselect.getConfig();
			configDataSetRoute.name = 'routecode';configDataSetRoute.action='routecode';configDataSetRoute.el='#routecodexm',configDataSetRoute.initValue=[resjson.routecode];
			var polxm = new randerXmselect.rander(xmSelect,configDataSetRoute);
			
			$('#booknos').text(resjson.nos);
			if(resjson.isubmit){
				$("button[class*='layui-btn']").addClass('layui-hide');
			}
		}
	});
	table.render({
		elem: '#cntTable'
	        ,height: 500
	        ,limit: Number.MAX_VALUE
	        ,url:getContextPath()+"/booking?method=getcsbookingdtl&id="+parav.id+getSid()
	        ,id:'cntTable'
	        ,toolbar: '#toolbar'
	        ,cols: [[
				{type: 'checkbox', fixed: 'left'},
				{field:'id', width:80, title: 'ID',hide:true},
	            {field: 'cntype', title: '柜型', width: 80, templet: '#selectTool'},
	            {field: 'cntcount', title: '数量', width: 80, edit: 'text'},
	            {field: 'markno', title: '唛头', width: 120, edit: 'text'},
	            {field: 'piece', title: '件数', width: 100, edit: 'text'},
	            {field: 'packagee', title: '包装', width: 100, edit: 'text'},
	            {field: 'hscode', title: '商品编码', width: 110, edit: 'text'},
	            {field: 'goodsnamee', title: '品名(英文)', width: 120, edit: 'text'},
	            {field: 'grswgt', title: '毛重', width: 80, edit: 'text'},
	            {field: 'cbm', title: '体积', width: 80, edit: 'text'},
	         ]]
            ,done: function (res, curr, count) {
    		    $('th').css({'background-color': '#7aa9d9', 'color': 'white','line-height': '38px'});
    	    }
	});
	table.render({
		elem: '#actTable'
	        ,height: 500
	        ,limit: Number.MAX_VALUE
	        ,url:getContextPath()+"/booking?method=getcsbookingfee&id="+parav.id+getSid()
	        ,id:'actTable'
	        ,toolbar: '#araptoolbar'
	        ,cols: [[
	            {field: 'araptype', title: '费用类型', width: 60},
	            //{field: 'cntype', title: '柜型', width: 110},
	            {field: 'ppcc', title: 'PP/CC', width: 120},
	            {field: 'feeitemame', title: '费用名称', width: 150},
	            {field: 'currency', title: '币制', width: 60},
	            {field: 'unit', title: '单位', width: 100,align : 'right'},
	            {field: 'cntcount', title: '数量', width: 60},
	            {field: 'amount', title: '金额', width: 100},
	            {fixed: 'right', title: '操作', width:150, align:'center', toolbar: '#arapBar'}
	         ]]
            ,done: function (res, curr, count) {
    		    $('th').css({'background-color': '#1e9fff', 'color': 'white>'});
    	    }
	});
	lay('.layuidata').each(function() {
		laydate.render({ 
		  elem: this
		  ,theme: '#1e9fff'
		});
	});
	//randerfromselect('/combobox','queryFeei?limit=20','checkbox_feei',formSelects,true);
	//randerfromselect('/combobox','queryCustomer?limit=20&type=arap','checkbox_custom',formSelects,true);
	//randerfromselect('/combobox','taskuer?limit=20','checkbox_taskuer',formSelects,true);
	var configDataSetfee = new randerXmselect.getConfig();
	configDataSetfee.name = 'feeitemid';configDataSetfee.action='queryFeei';configDataSetfee.el='#feeitemidxm';
	var feeitemidxm = new randerXmselect.rander(xmSelect,configDataSetfee);

	function querycnt(){
		table.reload('cntTable',{url:getContextPath()+"/booking?method=getcsbookingdtl&id="+parav.id+getSid()});
	}
	//头工具栏事件
	table.on('toolbar(cntdetail)', function(obj){
		var checkStatus = table.checkStatus(obj.config.id);
	    switch(obj.event){
	      case 'querycnt':
	    	  querycnt();
	      break;
	      case 'savecnt':
	  	    var jsonData = [];
	  	    for(var i=0;i<table.cache.cntTable.length;i++){
	  	    	var obj={}
	  	    	obj.id = table.cache.cntTable[i].id;
	  	    	obj.cntype = table.cache.cntTable[i].cntype;
	  	    	obj.cntcount = table.cache.cntTable[i].cntcount;
	  	    	obj.markno = table.cache.cntTable[i].markno;
	  	    	obj.piece = table.cache.cntTable[i].piece;
	  	    	obj.packagee = table.cache.cntTable[i].packagee;
	  	    	obj.hscode = table.cache.cntTable[i].hscode;
	  	    	obj.goodsnamee = table.cache.cntTable[i].goodsnamee;
	  	    	obj.grswgt = table.cache.cntTable[i].grswgt;
	  	    	obj.cbm = table.cache.cntTable[i].cbm;
	  	    	obj.bookingid = parav.id;
	  	    	jsonData.push(obj);
		  	}
	  	    console.log(jsonData);
	  	    actionPost('booking','savebookingdtl',JSON.stringify(jsonData),function(res){
	  	    	var jsonData = JSON.parse(res);
	  		    if(jsonData.success == true){
	  		    	layer.msg("OK!",{icon: 1});
	  		    }else{
	  		    	layer.msg(jsonData.msg,{icon: 7});
		  		}
	  	    });
		  break;
	      case 'deletecnt':
	    	  var data = checkStatus.data;
		      if(data.length<1){
		      	layer.msg("至少选择一行！",{icon: 5});
		        	return;
			  };
			  actionGet('/booking','deletebookingdtl',"cntids="+getids(data),function(res){
	    		  var jsonData = JSON.parse(res);
	    		  if(jsonData.error){
	    			  if(jsonData.error != ''){
	    			    	layer.alert(jsonData.error, {icon: 7});
	    			  }return;
	    		  }
	              if (checkStatus.data.length < 1) {
	                  layer.alert("请选择一条数据操作");
	                  return false;
	              } else {
	                  var cbList = table.cache.cntTable;
	                  for (var k = 0; k < checkStatus.data.length; k++) {
	                      var _delId = checkStatus.data[k].id;
	                      for (var i = 0; i < cbList.length; i++) {
	                          var _id = cbList[i].id;
	                          if (_id == _delId) {
	                              cbList.splice(i, 1);
	                              break;
	                          }
	                      }
	                  }
	                  table.reload("cntTable", {
	                	  url:"",
	                      data: cbList
	                  })
	              }
	              layer.msg("OK!",{icon: 1});
	    	  });
		  break;
	      case 'addcnt':
		      var datas = []
		      var tabledata = table.cache.cntTable;
		      if(tabledata!=null){
				for(var i=0;i<tabledata.length;i++){
					datas.push(tabledata[i]);
				}
			  }
		      datas.push({
		    	"id": -1   
	    	    ,"cntype": ""
	    	    ,"cntcount": 0
	    	    ,"markno": ""
	    	    ,"piece": 0
	    	    ,"packagee": ""
	    	    ,"hscode": ""
	    	    ,"goodsnamee": ""
		    	,"grswgt":null
		    	,"cbm":null
	    	  });
		      table.reload('cntTable', {
		    	  url:"",
		         data:datas
		      });
		  break;
	    };
	});
	// 监听表格中的下拉选择将数据同步到table.cache中
    form.on('select(selectCntype)', function (data) {
    	refreashgrid(data)
    });
    form.on('select(selecLldtype)', function (data) {
    	refreashgrid(data)
    });
    function refreashgrid(data){
    	 var selectElem = $(data.elem);
         var tdElem = selectElem.closest('td');
         var trElem = tdElem.closest('tr');
         var tableView = trElem.closest('.layui-table-view');
         table.cache[tableView.attr('lay-id')][trElem.data('index')][tdElem.data('field')] = data.value;
    }
	function getids(arrjson){
		var ids ="";
		for(var i=0;i<arrjson.length;i++){
			if(i==0){	
				ids=arrjson[i].id;
	    	}else{
				ids=ids+","+arrjson[i].id;
			}
	    }
	    return ids;
	};
	table.on('tool(arapFiter)', function(obj){
		var data = obj.data;
		var layEvent = obj.event;
		if(layEvent === 'barEdit'){
			var arraval = ['600px', '580px'];
	   		var tille = '编辑';
	  		if(isMove() == true){
	  			arraval = ['100%', '100%'];
	  			tille = '<button type="button" lay-filter="closelayer" onclick="closelayer()" lay-submit class="layui-btn layui-btn-sm supersmall">返回</button>';
	  	  	}
	   		layer.open({
	   		  title:tille,
	   		  type:1,
	   		  move: false,
	   		  fixed: false,
	   		  area: arraval, //宽高
	   		  content: $("#arapFilter")
	   		});
	   		form.val("arapFilter",data);
	   		form.val("arapFilter",{"cntype":data.cntype.replace(/(.{2})/,"$1'")});
			var feeis = [];feeis.push(data.feeitemid);
			feeitemidxm.setValue(feeis);
		}else if(layEvent=='bardelete'){
			actionGet('/booking','deletebookingfee',"arapids="+data.id,function(res){
		    	var resjson = JSON.parse(res);
		    	if(resjson.success == false){
		    		layer.msg(resjson.msg,{icon: 7});
				}else{
					layer.msg('OK',{icon: 1});
					table.reload('actTable');
				}
			});  
		}
	});
	form.on('submit(savebookingfee)',function(data){
		data.field.bookingid = parav.id;data.field.feeitemame = feeitemidxm.getValue("nameStr").split("/")[1]
		console.log(feeitemidxm.getValue("nameStr")); console.dir(data.field);
		actionPost('booking','savebookingfee',JSON.stringify(data.field),function(res){
		    	var resjson = JSON.parse(res);
		    	if(resjson.success == false){
		    		layer.msg(resjson.msg,{icon: 7});
				}else{
					layer.msg('OK',{icon: 1});
					table.reload('actTable');
				}
		});  
	});
	form.on('submit(savebook)',function(data){
		console.dir(data.field);
		actionPost('booking','savebook',JSON.stringify(data.field),function(res){
		    	var resjson = JSON.parse(res);
		    	if(resjson.success == false){
		    		layer.msg(resjson.msg,{icon: 7});
				}else{
					layer.msg('OK',{icon: 1});
					table.reload('actTable');
				}
		});  
	});
	form.on('submit(savebookisubmit)',function(data){
		data.field.isubmit = true;
		console.dir(data.field);
		actionPost('booking','savebook',JSON.stringify(data.field),function(res){
		    	var resjson = JSON.parse(res);
		    	if(resjson.success == false){
		    		layer.msg(resjson.msg,{icon: 7});
				}else{
					layer.msg('OK',{icon: 1});
					table.reload('actTable');
				}
		});  
	});
	form.on('submit(applyBPMform)',function(data){
		var arraval = ['600px', '580px'];
   		var tille = '发起流程';
  		if(isMove() == true){
  			arraval = ['100%', '100%'];
  			tille = '<button type="button" lay-filter="closelayer" onclick="closelayer()" lay-submit class="layui-btn layui-btn-sm supersmall">返回</button>';
  	  	}
   		layer.open({
   		  title:tille,
   		  type:1,
   		  move: false,
   		  fixed: false,
   		  area: arraval, //宽高
   		  content: $("#jobtodoitem")
   		});
	});
	form.on('submit(applyBPM)',function(data){
		var datajsonstring = JSON.stringify(data.field);
		var taskuer = formSelects.value('checkbox_taskuer', 'valStr');
		var para = new Object;
		para.taskuer = taskuer;
		para.bpmassign = data.field.bpmassign;
		para.bpmremark = data.field.bpmremark;
		para.nos = data.field.nos;
		para.id = parav.id;
		para.processid=6544894888;
		if(para.bpmassign!=null&&para.bpmassign==''){
			alert("#{l.m['下一步环节必填']}!");
			return false;
		}
    	actionPost('/bpm','applyBPM',JSON.stringify(para),function(res){
    		var resjson = JSON.parse(res);
        	if(resjson.success == true){
        		layer.msg("OK",{icon: 1});
        	}else{
				layer.msg(resjson.msg,{icon: 7});
			}
    	})
	});
	
	table.on('toolbar(arapFiter)', function(obj){
		var checkStatus = table.checkStatus(obj.config.id);
		var para = new Object;
		para.jobid = parav.id;
	    switch(obj.event){
	      case 'addarap':
	    	actionPost('/jobs','getAddArap',JSON.stringify(para),function(res){
	      		var resjson = JSON.parse(res);//console.log(resjson);
	          	if(resjson.success == true){
	          		var arraval = ['600px', '580px'];
			   		var tille = '编辑';
			  		if(isMove() == true){
			  			arraval = ['100%', '100%'];
			  			tille = '<button type="button" lay-filter="closelayer" onclick="closelayer()" lay-submit class="layui-btn layui-btn-sm supersmall">返回</button>';
			  	  	}
			   		layer.open({
			   		  title:tille,
			   		  type:1,
			   		  move: false,
			   		  fixed: false,
			   		  area: arraval, //宽高
			   		  content: $("#arapFilter")
			   		});
			   		resjson.arapData.id = -1;
			   		$("#arapFilter")[0].reset();
			   		form.val("arapFilter",resjson.arapData);
			   		var customs = [];customs.push(0);
					var feeis = [];feeis.push(0);
					//formSelects.value('checkbox_custom',customs);
					//formSelects.value('checkbox_feei',feeis);
					//customeridxm.setValue(customs);
					feeitemidxm.setValue(feeis);
	          	}else{
	  				layer.msg(resjson.msg,{icon: 7});
	  			}
	      	})
	      break;
	    }
	});
	$('input[name=price]').on('input propertychange', function() {//监听单价改变
		culAmountprice();
	});
	$('input[name=piece]').on('input propertychange', function() {//监听数量改变
		culAmountprice();
	});
	$('input[name=amount]').on('input propertychange', function() {//监听金额改变
		culAmountamont();
	});
	function culAmountprice(){//改变单价或者数量时候触发
		var price = $('input[name=price]').val();//单价
		var piece = $('input[name=piece]').val();//数量
		var amount = $('input[name=amount]').val();//金额
		if(price==null||price==''){
			price = 0 ;
		}
		if(piece==null||piece==''){
			piece = 1 ;
		}//console.log(price);console.log(piece);
		$('input[name=amount]').val(price*piece);//金额 = 单价*数量
	}
	function culAmountamont(){//改变金额时候触发
		var price = $('input[name=price]').val();//单价
		var piece = $('input[name=piece]').val();//数量
		var amount = $('input[name=amount]').val();//金额
		if(amount==null||amount==''){
			price = 0 ;
		}
		if(piece==null||piece==''){
			piece = 1 ;
		}
		$('input[name=price]').val(amount/piece);//金额 = 单价*数量
	}
});

$('.site-demo-active').on('click', function(){
    var othis = $(this), type = othis.data('type');
    active[type] ? active[type].call(this, othis) : '';
  });
</script>
<script type="text/javascript">
    var cntypeArr = [];
    
    actionGet('/combobox','cntypecode','',function(res){
		var jsonData = JSON.parse(res);
	    cntypeArr = jsonData;
    });
</script>
<script type="text/html" id="selectTool">
	    <select name="cntype" dataId="{{d.id}}" lay-filter="selectCntype" lay-search>
			<option value=''></option>
	        {{# layui.each(cntypeArr, function(index, item){}}
	        	<option value={{item.val}} {{ (d.cntype==item.val)?'selected' : '' }}>{{ item.label }}</option>
	        {{# }); }}
	    </select>
</script>
<script src="/so/index?method=getCssForButton&pid=299000"></script>
</body>
</html>